#pragma checksum "C:\Users\Yasuraoka\source\repos\SeismicWeb5\SeismicWeb5\Views\Home\EvacuationPath.cshtml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "df198ece20259bf54a5aa9af1150c9a410e65993c20c8f9521c5734b7ad0bf97"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Views_Home_EvacuationPath), @"mvc.1.0.view", @"/Views/Home/EvacuationPath.cshtml")]
namespace AspNetCore
{
    #line hidden
    using global::System;
    using global::System.Collections.Generic;
    using global::System.Linq;
    using global::System.Threading.Tasks;
    using global::Microsoft.AspNetCore.Mvc;
    using global::Microsoft.AspNetCore.Mvc.Rendering;
    using global::Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 1 "C:\Users\Yasuraoka\source\repos\SeismicWeb5\SeismicWeb5\Views\_ViewImports.cshtml"
using SeismicWeb5;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Yasuraoka\source\repos\SeismicWeb5\SeismicWeb5\Views\_ViewImports.cshtml"
using SeismicWeb5.Models;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA256", @"df198ece20259bf54a5aa9af1150c9a410e65993c20c8f9521c5734b7ad0bf97", @"/Views/Home/EvacuationPath.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA256", @"35e271372afa81d510bf36531c0e0f6cb90e3cc67486c22b578a5c8584c8947d", @"/Views/_ViewImports.cshtml")]
    #nullable restore
    public class Views_Home_EvacuationPath : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
    #nullable disable
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
            WriteLiteral("\r\n");
#nullable restore
#line 2 "C:\Users\Yasuraoka\source\repos\SeismicWeb5\SeismicWeb5\Views\Home\EvacuationPath.cshtml"
  
    ViewData["Title"] = "EvacuationPath";

#line default
#line hidden
#nullable disable
            WriteLiteral(@"

<div id=""map"" style=""height: 90vh; width: 70vw"">

<script>
    var map;
    var evacuationSites;
    var coordinates;
    function initMap() {
        var mapProp = {
            center: { lat: 14.58662208198707, lng: 120.97741379178726 },
            zoom: 8,
        };
        map = new google.maps.Map(document.getElementById(""map""), mapProp);
    }

    function getCoordinates() {
        navigator.geolocation.getCurrentPosition(position => {
            coordinates = { lat: position.coords.latitude, lng: position.coords.longitude };
        }, error => {
            console.log(""error getting coordinates"")
        })
        
    }

    async function getEvacuationSites() {
            var response = await fetch('https://seismoweb-9e2a6-default-rtdb.asia-southeast1.firebasedatabase.app/EvacuationSites.json', {
            headers: {
                'Accept': 'application/json'
            }
            }).then(response => {
                if(! response.ok) {
            ");
            WriteLiteral(@"        throw new Error(""HTTP ERROR RESPONSE""); 
                }

                return response.json()
            }).then(data => {
                console.log(Object.values(data))
                evacuationSites = Object.values(data)
            })

            evacuationSites.forEach(x => {
                new google.maps.Marker({
                    position: {lat: x.lat, lng: x.lng},
                    map,
                    title: x.name
                })
            })

            drawEvacuationSite(evacuationSites, coordinates)
    }

    function getNearest(sites, origin) {
        let nearestCoordinate = null;
        let nearestDistance = Infinity;

        for (const coordinate of sites) {
            const latDiff = coordinate.lat - origin.lat;
            const lngDiff = coordinate.lng - origin.lng;
            const distance = Math.sqrt(latDiff ** 2 + lngDiff ** 2);

            if (distance < nearestDistance) {
                nearestCoordinate = coordina");
            WriteLiteral(@"te;
                nearestDistance = distance;
            }
        }

        return { lat: nearestCoordinate.lat, lng: nearestCoordinate.lng };
    }


    function drawEvacuationSite(sites, origin) {
        var nearest = getNearest(sites, origin)

        const directionsRenderer = new google.maps.DirectionsRenderer();
        const directionService = new google.maps.DirectionsService();
        console.log(nearest,origin)
        directionService.route({
            origin: new google.maps.LatLng(origin),
            destination: new google.maps.LatLng(nearest),
            travelMode: 'WALKING'
        }, function (result, status) {
            if (status == 'OK') {
                directionsRenderer.setDirections(result)
                directionsRenderer.setMap(map)
                directionsRenderer.setPanel(null)
            } else {
                alert(""Destination cannot be rendered"")
            }
        })
    }

    getCoordinates();
    getEvacuationSites();");
            WriteLiteral("\r\n</script>\r\n</div>\r\n");
        }
        #pragma warning restore 1998
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<dynamic> Html { get; private set; } = default!;
        #nullable disable
    }
}
#pragma warning restore 1591
